const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-misc-VzfOjbg5.js","assets/utils-DZAv-WBo.js"])))=>i.map(i=>d[i]);
import{c as e,r as s,t,j as a,S as n,R as r,T as o,C as i,a as l,D as c,b as d,A as m,P as u,O as g,d as h,_ as x,e as p,f,g as v,h as j,i as b,k as N,l as y,u as w,s as S,B as k,N as C,m as T,n as _,o as E,p as M}from"./vendor-CtXyHbat.js";import{p as P,t as F,c as I}from"./utils-DZAv-WBo.js";import{k as L}from"./vendor-misc-VzfOjbg5.js";import{z}from"./forms-DqW0J_RQ.js";import"./ui-1jqlrV-B.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)}).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();const A=e(e=>({token:localStorage.getItem("token")||null,user:JSON.parse(localStorage.getItem("user"))||null,setToken:s=>{e({token:s}),s?localStorage.setItem("token",s):localStorage.removeItem("token")},setUser:s=>{e({user:s}),s?localStorage.setItem("user",JSON.stringify(s)):localStorage.removeItem("user")},logout:()=>{e({token:null,user:null}),localStorage.removeItem("token"),localStorage.removeItem("user")},messages:[],setMessages:s=>e({messages:s}),addMessage:s=>e(e=>({messages:[s,...e.messages]})),updateMessage:s=>e(e=>({messages:e.messages.map(e=>e._id===s._id?s:e)})),deleteMessage:s=>e(e=>({messages:e.messages.filter(e=>e._id!==s)})),activeTab:"inbox",setActiveTab:s=>e({activeTab:s}),loading:!1,setLoading:s=>e({loading:s}),error:null,setError:s=>e({error:s})})),$=async e=>{if(!e.ok){let t={};try{t=await e.json()}catch(s){t={message:e.statusText}}const a=new Error(t.message||`HTTP error! status: ${e.status}`);throw a.status=e.status,a.data=t,a}return e.json()},O=async(e,s)=>{const t=await fetch(`undefined${e}`,{headers:{Authorization:s?`Bearer ${s}`:""}});return $(t)},D=async(e,s,t)=>{const a=await fetch(`undefined${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify(s)});return $(a)},U=async(e,s,t)=>{const a=await fetch(`undefined${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},body:JSON.stringify(s)});return $(a)},B=async(e,s)=>{const t=await fetch(`undefined${e}`,{method:"DELETE",headers:{Authorization:s?`Bearer ${s}`:""}});return $(t)};function R(...e){return F(I(e))}const q=L("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function V({className:e,variant:s,size:t,asChild:r=!1,...o}){const i=r?n:"button";return a.jsx(i,{"data-slot":"button",className:R(q({variant:s,size:t,className:e})),...o})}function J({...e}){return a.jsx(r,{"data-slot":"alert-dialog",...e})}function G({...e}){return a.jsx(o,{"data-slot":"alert-dialog-trigger",...e})}function K({...e}){return a.jsx(u,{"data-slot":"alert-dialog-portal",...e})}function W({className:e,...s}){return a.jsx(g,{"data-slot":"alert-dialog-overlay",className:R("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...s})}function H({className:e,...s}){return a.jsxs(K,{children:[a.jsx(W,{}),a.jsx(i,{"data-slot":"alert-dialog-content",className:R("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...s})]})}function Q({className:e,...s}){return a.jsx("div",{"data-slot":"alert-dialog-header",className:R("flex flex-col gap-2 text-center sm:text-left",e),...s})}function X({className:e,...s}){return a.jsx("div",{"data-slot":"alert-dialog-footer",className:R("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...s})}function Y({className:e,...s}){return a.jsx(l,{"data-slot":"alert-dialog-title",className:R("text-lg font-semibold",e),...s})}function Z({className:e,...s}){return a.jsx(c,{"data-slot":"alert-dialog-description",className:R("text-muted-foreground text-sm",e),...s})}function ee({className:e,...s}){return a.jsx(m,{className:R(q(),e),...s})}function se({className:e,...s}){return a.jsx(d,{className:R(q({variant:"outline"}),e),...s})}const te=({triggerText:e,title:s,description:t,onConfirm:n,children:r})=>a.jsxs(J,{children:[a.jsx(G,{asChild:!0,children:r||a.jsx(V,{variant:"outline",children:e})}),a.jsxs(H,{children:[a.jsxs(Q,{children:[a.jsx(Y,{children:s}),a.jsx(Z,{children:t})]}),a.jsxs(X,{children:[a.jsx(se,{children:"Cancel"}),a.jsx(ee,{onClick:n,children:"Continue"})]})]})]}),ae=()=>{var e,n,r,o;const{setMessages:i,deleteMessage:l,activeTab:c,setActiveTab:d,token:m,loading:u,setLoading:g,error:x,setError:p}=A(),{messages:f}=(()=>{const{messages:e,setMessages:a,activeTab:n,token:r,setLoading:o,setError:i}=A();return s.useEffect(()=>{(async()=>{var e;o(!0),i(null);try{const e=await O(`/messages?type=${n}`,r);a(e)}catch(s){const a=(null==(e=s.data)?void 0:e.message)||s.message||"Failed to fetch messages";i(a),t.error(a)}finally{o(!1)}})()},[n,r,a,o,i]),{messages:e}})(),[v,j]=h.useState(null),b=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return u?a.jsx("div",{className:"loading",children:"Loading messages..."}):a.jsxs("div",{className:"private-message-inbox",children:[a.jsxs("div",{className:"inbox-header",children:[a.jsx("h2",{children:"Private Messages"}),a.jsxs("div",{className:"tab-buttons",children:[a.jsx("button",{className:"inbox"===c?"active":"",onClick:()=>d("inbox"),children:"Inbox"}),a.jsx("button",{className:"sent"===c?"active":"",onClick:()=>d("sent"),children:"Sent"})]})]}),x&&a.jsx("div",{className:"error-message",children:x}),a.jsxs("div",{className:"inbox-content",children:[a.jsx("div",{className:"message-list",children:0===f.length?a.jsx("div",{className:"no-messages",children:"No messages found"}):f.map(e=>{var s,n,r,o;return a.jsxs("div",{className:"message-item "+(e.read||"inbox"!==c?"":"unread"),onClick:()=>(async e=>{var s;p(null);try{const s=await O(`/messages/${e}`,m);j(s),"inbox"!==c||s.read||(await U(`/messages/${e}/read`,{read:!0},m),i(s=>s.map(s=>s._id===e?{...s,read:!0}:s)))}catch(a){const e=(null==(s=a.data)?void 0:s.message)||a.message||"Failed to fetch message details";p(e),t.error(e)}})(e._id),children:[a.jsxs("div",{className:"message-header",children:[a.jsx("span",{className:"sender",children:"inbox"===c?`${(null==(s=e.sender)?void 0:s.username)||"Unknown"} (${(null==(n=e.sender)?void 0:n.email)||"No Email"})`:`${(null==(r=e.receiver)?void 0:r.username)||"Unknown"} (${(null==(o=e.receiver)?void 0:o.email)||"No Email"})`}),a.jsx("span",{className:"date",children:b(e.sentAt)})]}),a.jsx("div",{className:"message-subject",children:e.subject}),a.jsx("div",{className:"message-preview message-preview-ellipsis",children:e.content})]},e._id)})}),v&&a.jsxs("div",{className:"message-detail",children:[a.jsxs("div",{className:"message-detail-header",children:[a.jsx("h3",{children:v.subject}),a.jsx("button",{className:"close-button",onClick:()=>j(null),children:"×"})]}),a.jsxs("div",{className:"message-meta",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"From:"})," ",null==(e=v.sender)?void 0:e.username," (",null==(n=v.sender)?void 0:n.email,")"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"To:"})," ",null==(r=v.receiver)?void 0:r.username," (",null==(o=v.receiver)?void 0:o.email,")"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Date:"})," ",b(v.sentAt)]})]}),a.jsx("div",{className:"message-content",children:v.content}),a.jsx("div",{className:"message-actions",children:a.jsx(te,{triggerText:"Delete",title:"Confirm Deletion",description:"Are you sure you want to delete this message? This action cannot be undone.",onConfirm:()=>(async e=>{var s;p(null);try{await B(`/messages/${e}`,m),l(e),j(null),t.success("Message deleted successfully!")}catch(a){const e=(null==(s=a.data)?void 0:s.message)||a.message||"Failed to delete message";p(e),t.error(e)}})(v._id),children:a.jsx("button",{className:"delete-button",children:"Delete"})})})]})]})]})};function ne({className:e,...s}){return a.jsx(x,{"data-slot":"command",className:R("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",e),...s})}function re({className:e,...s}){return a.jsxs("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[a.jsx(p,{className:"size-4 shrink-0 opacity-50"}),a.jsx(x.Input,{"data-slot":"command-input",className:R("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",e),...s})]})}function oe({className:e,...s}){return a.jsx(x.List,{"data-slot":"command-list",className:R("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",e),...s})}function ie({...e}){return a.jsx(x.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...e})}function le({className:e,...s}){return a.jsx(x.Group,{"data-slot":"command-group",className:R("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",e),...s})}function ce({className:e,...s}){return a.jsx(x.Item,{"data-slot":"command-item",className:R("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...s})}function de({...e}){return a.jsx(f,{"data-slot":"popover",...e})}function me({...e}){return a.jsx(v,{"data-slot":"popover-trigger",...e})}function ue({className:e,align:s="center",sideOffset:t=4,...n}){return a.jsx(j,{children:a.jsx(b,{"data-slot":"popover-content",align:s,sideOffset:t,className:R("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",e),...n})})}const ge=e=>{if("string"!=typeof e)return"";return P.sanitize(e,{ALLOWED_TAGS:[],KEEP_CONTENT:!0}).trim().replace(/\s+/g," ")},he=({onUserSelect:e,selectedUser:n})=>{const[r,o]=s.useState(!1),[i,l]=s.useState(""),[c,d]=s.useState([]),[m,u]=s.useState(!1),{token:g}=A(),h=s.useRef(null);s.useEffect(()=>{const e=ge(i);e.length>2?(h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{x(e)},500)):d([])},[i,g]);const x=async e=>{var s;u(!0);try{const s=encodeURIComponent(ge(e)),t=await O(`/users/search?query=${s}`,g);d(t)}catch(a){const e=(null==(s=a.data)?void 0:s.message)||a.message||"Failed to search users";t.error(e),d([])}finally{u(!1)}};return a.jsxs(de,{open:r,onOpenChange:o,children:[a.jsx(me,{asChild:!0,children:a.jsxs(V,{variant:"outline",role:"combobox","aria-expanded":r,className:"w-[200px] justify-between",children:[n?n.username:"Select user...",a.jsx(N,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),a.jsx(ue,{className:"w-[200px] p-0",children:a.jsxs(ne,{children:[a.jsx(re,{placeholder:"Search user...",value:i,onValueChange:l}),a.jsxs(oe,{children:[m&&a.jsx(ie,{children:"Searching..."}),!m&&0===c.length&&i.length>2&&a.jsx(ie,{children:"No user found."}),a.jsx(le,{children:c.map(s=>a.jsxs(ce,{value:s.username,onSelect:()=>{e(s),o(!1)},children:[a.jsx(y,{className:R("mr-2 h-4 w-4",n&&n._id===s._id?"opacity-100":"opacity-0")}),s.username," (",s.email,")"]},s._id))})]})]})})]})},xe=z.object({subject:z.string().min(1,"Subject is required").max(200,"Subject must be less than 200 characters").transform(e=>{return s=e,P.sanitize(s,{USE_PROFILES:{html:!1,svg:!1,mathMl:!1}});var s}).refine(e=>e.trim().length>0,"Subject cannot be empty or contain only whitespace"),content:z.string().min(1,"Message content is required").max(5e3,"Message must be less than 5000 characters").transform(e=>{return s=e,P.sanitize(s,{USE_PROFILES:{html:!1,svg:!1,mathMl:!1}});var s}).refine(e=>e.trim().length>0,"Message cannot be empty or contain only whitespace")}),pe=({onMessageSent:e,onCancel:n,replyTo:r=null})=>{const{token:o}=A(),{sendMessage:i,sending:l}=(()=>{const{token:e,addMessage:a,setLoading:n}=A(),[r,o]=s.useState(!1);return{sendMessage:async s=>{var r;o(!0),n(!0);try{const n=await D("/messages",s,e);return a(n),t.success("Message sent successfully!"),n}catch(i){const e=(null==(r=i.data)?void 0:r.message)||i.message||"Failed to send message. Please try again.";throw t.error(e),i}finally{o(!1),n(!1)}},sending:r}})(),[c,d]=s.useState((null==r?void 0:r.sender)?{_id:r.sender._id,username:r.sender.username,email:r.sender.email}:null),{register:m,handleSubmit:u,formState:{errors:g,isValid:h},reset:x,watch:p}=w({resolver:S(xe),defaultValues:{subject:r?`Re: ${r.subject}`:"",content:""},mode:"onChange"}),f=p("subject"),v=p("content");return a.jsxs("div",{className:"compose-message",children:[a.jsxs("div",{className:"compose-header",children:[a.jsx("h3",{children:r?"Reply to Message":"Compose New Message"}),n&&a.jsx("button",{className:"close-button",onClick:n,children:"×"})]}),a.jsxs("form",{onSubmit:u(async s=>{if(c)try{const t={receiverId:c._id,subject:s.subject,content:s.content,parentMessageId:(null==r?void 0:r._id)||null};await i(t),x(),d(null),e&&e()}catch(a){}else t.error("Please select a recipient")}),className:"compose-form",children:[!r&&a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"receiverId",children:"To: *"}),a.jsx(he,{onUserSelect:d,selectedUser:c}),c&&a.jsxs("small",{className:"help-text",children:["Selected: ",c.username," (",c.email,")"]}),g.receiverId&&a.jsx("small",{className:"error-message",children:g.receiverId.message})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"subject",children:"Subject: *"}),a.jsx("input",{type:"text",id:"subject",...m("subject"),placeholder:"Enter message subject",className:g.subject?"error":""}),a.jsxs("div",{className:"field-info",children:[a.jsxs("small",{className:"char-count",children:[(null==f?void 0:f.length)||0,"/200 characters"]}),g.subject&&a.jsx("small",{className:"error-message",children:g.subject.message})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"content",children:"Message: *"}),a.jsx("textarea",{id:"content",...m("content"),placeholder:"Enter your message",rows:"8",className:g.content?"error":""}),a.jsxs("div",{className:"field-info",children:[a.jsxs("small",{className:"char-count",children:[(null==v?void 0:v.length)||0,"/5000 characters"]}),g.content&&a.jsx("small",{className:"error-message",children:g.content.message})]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"submit",className:"send-button",disabled:l||!h||!r&&!c,children:l?"Sending...":"Send Message"}),n&&a.jsx("button",{type:"button",className:"cancel-button",onClick:n,children:"Cancel"})]})]})]})};function fe(){const e=A(e=>e.setActiveTab);return a.jsxs(k,{children:[a.jsxs("div",{className:"App",children:[a.jsx("header",{className:"app-header",children:a.jsxs("div",{className:"container mx-auto px-4",children:[a.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-center mb-4",children:"Museum Collection Platform - Advanced Forum Features"}),a.jsx("nav",{className:"main-nav",children:a.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-4 sm:gap-6",children:[a.jsx(C,{to:"/",className:({isActive:e})=>"px-4 py-2 rounded-md transition-all duration-300 border border-white/30 text-center "+(e?"bg-white/20 border-white/50":"hover:bg-white/10"),onClick:()=>e("inbox"),children:"Messages"}),a.jsx(C,{to:"/compose",className:({isActive:e})=>"px-4 py-2 rounded-md transition-all duration-300 border border-white/30 text-center "+(e?"bg-white/20 border-white/50":"hover:bg-white/10"),onClick:()=>e("compose"),children:"Compose"})]})})]})}),a.jsx("main",{className:"app-main flex-1 p-4 md:p-6",children:a.jsx("div",{className:"container mx-auto max-w-6xl",children:a.jsxs(T,{children:[a.jsx(_,{path:"/",element:a.jsx(ae,{})}),a.jsx(_,{path:"/compose",element:a.jsx(pe,{onMessageSent:()=>e("inbox"),onCancel:()=>e("inbox")})})]})})}),a.jsx("footer",{className:"app-footer bg-gray-800 text-white text-center py-4",children:a.jsx("div",{className:"container mx-auto px-4",children:a.jsx("p",{className:"text-sm",children:"Museum Collection Platform - Task 7.3: Advanced Forum Features Demo"})})})]}),a.jsx(E,{position:"bottom-right",richColors:!0})]})}const ve={};var je;M.createRoot(document.getElementById("root")).render(a.jsx(s.StrictMode,{children:a.jsx(fe,{})})),(je=console.log)&&je instanceof Function&&function(e,s){let t=Promise.resolve();if(s&&s.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),n=(null==a?void 0:a.nonce)||(null==a?void 0:a.getAttribute("nonce"));t=e(s.map(e=>{if((e=function(e){return"/"+e}(e))in ve)return;ve[e]=!0;const s=e.endsWith(".css"),t=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${t}`))return;const a=document.createElement("link");return a.rel=s?"stylesheet":"modulepreload",s||(a.as="script"),a.crossOrigin="",a.href=e,n&&a.setAttribute("nonce",n),document.head.appendChild(a),s?new Promise((s,t)=>{a.addEventListener("load",s),a.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=e,window.dispatchEvent(s),!s.defaultPrevented)throw e}return t.then(s=>{for(const e of s||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})}(async()=>{const{getCLS:e,getFID:s,getFCP:t,getLCP:a,getTTFB:n}=await import("./vendor-misc-VzfOjbg5.js").then(e=>e.w);return{getCLS:e,getFID:s,getFCP:t,getLCP:a,getTTFB:n}},__vite__mapDeps([0,1])).then(({getCLS:e,getFID:s,getFCP:t,getLCP:a,getTTFB:n})=>{e(je),s(je),t(je),a(je),n(je)});
//# sourceMappingURL=index-P7KS4Di7.js.map
